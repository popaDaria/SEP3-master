@page "/addHospital"
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Buttons
@using InputType = Syncfusion.Blazor.Inputs.InputType
@using SEP3.Data
@using SEP3.Model
@using Syncfusion.Blazor.PdfViewer
@using SEP3.Auth
@using Microsoft.VisualBasic.CompilerServices

@inject ICloudHospitalService CloudHospitalService;
@inject AuthenticationStateProvider AuthenticationStateProvider;
@inject NavigationManager NavigationManager

<link href="css/style.css" type="text/css" rel="stylesheet"/>

<div class="surroundBody2">
    <div class="col-lg-12 control-section">
        <div class="content-wrapper2">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                    <b>Send a new hospital to be reviewed and added to the platform</b>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                    <SfTextBox Placeholder="Name" FloatLabelType="@FloatLabelType.Auto" @bind-value="@toAdd.name"></SfTextBox>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                    <div class="radio-control">
                        <div class="row">
                            <label>
                                Type:
                                <select @bind="toAdd.type">
                                    <option value="">--Select an option--</option>
                                    <option value="hospital">Hospital</option>
                                    <option value="clinic">Clinic</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12col-md-12">
                    <SfTextBox CssClass="e-rtl" Placeholder="Postal Code" Type="Syncfusion.Blazor.Inputs.InputType.Number" FloatLabelType="@FloatLabelType.Auto" @bind-value="@postalCode"></SfTextBox>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                    <SfTextBox CssClass="e-rtl" Placeholder="Whole Address" FloatLabelType="@FloatLabelType.Auto" Multiline="true" @bind-value="@toAdd.address"></SfTextBox>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                    <SfTextBox CssClass="e-rtl" Placeholder="Description" FloatLabelType="@FloatLabelType.Auto" Multiline="true" @bind-value="@toAdd.info"></SfTextBox>
                </div>
            </div>
            <button type="button" class="btn btn-primary button3" @onclick="@Submit">Submit</button>
        </div>
    </div>
</div>



@code  {

    Hospital toAdd { get; set; } = new Hospital();
    string selection {get;set;}
    string postalCode { get; set; }

    public async Task Submit()
    {
        toAdd.managerId = Int32.Parse(AuthenticationStateProvider.GetAuthenticationStateAsync().Result.User.Claims.ToList()[0].Value);
        if (selection != null)
        {
            if (!selection.Equals(""))
            {
                toAdd.type = selection;
            }
        }
        else
        {
            selection = "hospital";
        }
        toAdd.postalCode = Int32.Parse(postalCode);
        Console.WriteLine(toAdd.managerId);
        await CloudHospitalService.AddHospital(toAdd);
        NavigationManager.NavigateTo("/");
    }

    public void SelectionChanged(ChangedEventArgs args)
    {
        selection = args.Value.ToString();
        Console.WriteLine(selection);
    }
}