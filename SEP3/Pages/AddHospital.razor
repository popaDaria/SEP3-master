@page "/addHospital"
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Buttons
@using InputType = Syncfusion.Blazor.Inputs.InputType
@using SEP3.Data
@using SEP3.Model
@using Syncfusion.Blazor.PdfViewer
@using SEP3.Auth
@using Microsoft.VisualBasic.CompilerServices

@inject ICloudHospitalService CloudHospitalService;
@inject AuthenticationStateProvider AuthenticationStateProvider;
@inject NavigationManager NavigationManager
@using Syncfusion.Blazor.DropDowns
@using Newtonsoft.Json

<link href="css/style.css" type="text/css" rel="stylesheet"/>

<div class="surroundBody2">
    <div class="col-lg-12 control-section">
        <div class="content-wrapper2">
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 formStyle23">
                    <b>Send a new hospital to be reviewed and added to the platform</b>
                </div>
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 ">
                    <SfTextBox Placeholder="Name" FloatLabelType="@FloatLabelType.Auto" @bind-value="@toAdd.name"></SfTextBox>
                </div>
            <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 formStyle23">
                <SfDropDownList TItem="Type" TValue="string" PopupHeight="200px" Placeholder="--Select an option--" DataSource="@types">
                    <DropDownListEvents TItem="Type" TValue="string" ValueChange="OnChange"></DropDownListEvents>
                    <DropDownListFieldSettings Text="Text" Value="ID"></DropDownListFieldSettings>
                </SfDropDownList>
            </div>
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 ">
                    <SfTextBox CssClass="e-rtl" Placeholder="Postal Code" Type="InputType.Number" FloatLabelType="@FloatLabelType.Auto" @bind-value="@postalCode"></SfTextBox>
                </div>
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 ">
                    <SfTextBox CssClass="e-rtl" Placeholder="Whole Address" FloatLabelType="@FloatLabelType.Auto" Multiline="true" @bind-value="@toAdd.address"></SfTextBox>
                </div>
                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12 ">
                    <SfTextBox CssClass="e-rtl" Placeholder="Description" FloatLabelType="@FloatLabelType.Auto" Multiline="true" @bind-value="@toAdd.info"></SfTextBox>
                </div>
            <button type="button" class="btn btn-primary button3" @onclick="@Submit">Submit</button>
        </div>
    </div>
</div>



@code  {

    Hospital toAdd { get; set; } = new Hospital();
    string selection {get;set;}
    string postalCode { get; set; }

    private string textValue { get; set; }
    public class Type
    {
        public string ID { get; set; }
        public string Text { get; set; }
    }
    private List<Type> types = new List<Type>() {
        new Type(){ ID= "0", Text= "--Select an option--" },
        new Type(){ ID= "1", Text= "Hospital" },
        new Type(){ ID= "2", Text= "Clinic" },
    };
    
    public string DropVal = "0";
    public string ChangeValue { get; set; } = "--Select an option--";
    
    public void OnChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, Type> args)
    {
        textValue = args.ItemData.Text;
    }
    
    public async Task Submit()
    {
        toAdd.managerId = Int32.Parse(AuthenticationStateProvider.GetAuthenticationStateAsync().Result.User.Claims.ToList()[0].Value);
        if (selection != null)
        {
            if (!selection.Equals(""))
            {
                toAdd.type = selection;
            }
        }
        else
        {
            selection = "hospital";
        }
        toAdd.type = textValue;
        toAdd.postalCode = Int32.Parse(postalCode);
        Console.WriteLine(toAdd.managerId);
        await CloudHospitalService.AddHospital(toAdd);
        NavigationManager.NavigateTo("/");
    }

    public void SelectionChanged(ChangedEventArgs args)
    {
        selection = args.Value.ToString();
        Console.WriteLine(selection);
    }
}